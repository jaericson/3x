#!/usr/bin/env bash
# check-condition -- check whether given file satisfies condition
# Usage: check-condition CONDITION [NAME[=VALUE[,VALUE]...]]...
#
# Author: Jaeho Shin <netj@cs.stanford.edu>
# Created: 2012-11-10
set -eu

conditionFile=$1; shift

# empty condition is true
[ $# -gt 0 ] || exit 0

outcomeFile=${conditionFile%.condition}.outcome

# load the files
source "$conditionFile"
source "$outcomeFile"

# check each condition
for cond in "$@"; do
    name=${cond%%=*}
    values=${cond#$name=}
    v=${!name}
    [[ $values = @(*,|)$v@(|,*) ]] || false error "$name=$v not in $values"
done

#!/usr/bin/env bash
# 3x-status -- display status of current queue
# 
# > 3x status
#
# Author: Jaeho Shin <netj@cs.stanford.edu>
# Created: 2013-01-14
set -eu

. find-runner.sh -

# TODO add CLI switch to selectively show DONE/RUNNING/PLANNED

{
    PREFIXPATT='^run[[:space:]][[:space:]]*'

    # runs already finished
    if [ -r done ]; then
        sed "s:$PREFIXPATT:DONE :" <"done"
    fi

    # runs running now
    if [ -r running ]; then
        sed "s:$PREFIXPATT:RUNNING :" <running
    fi

    # runs planned
    if [ -r plan ]; then
        serialOnEachLine plan $(( $(cat .count 2>/dev/null || echo 0) + 1 )) |
        sed "s:$PREFIXPATT:PLANNED :"
    fi
} | column -t
